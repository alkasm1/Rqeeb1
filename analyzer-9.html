<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ù‚ÙŠØ¨ Ø§Ù„Ù…Ø·ÙˆØ± - Ù…Ù†ØµØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#7C3AED',
                        accent: '#10B981'
                    }
                }
            }
        }
    </script>
    <style>
        .selection-box {
            border: 2px solid #5D5CDE;
            background: rgba(93, 92, 222, 0.1);
            position: absolute;
            cursor: move;
        }
        .resize-handle {
            width: 8px;
            height: 8px;
            background: #5D5CDE;
            position: absolute;
            cursor: nw-resize;
        }
        .canvas-container {
            position: relative;
            display: inline-block;
            border: 2px dashed #e5e7eb;
            transition: border-color 0.3s;
        }
        .canvas-container:hover {
            border-color: #5D5CDE;
        }
        .analysis-result {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Dark Mode Detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="text-3xl">ğŸ“·</div>
                    <div>
                        <h1 class="text-2xl font-bold text-primary">Ø±Ù‚ÙŠØ¨ Ø§Ù„Ù…Ø·ÙˆØ±</h1>
                        <p class="text-gray-600 dark:text-gray-400">Ù…Ù†ØµØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Øª</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 space-x-reverse text-sm text-gray-500 dark:text-gray-400">
                    <span>ğŸ”¬</span>
                    <span>ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù…</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Upload Section -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-6 flex items-center">
                <span class="ml-2">ğŸ“¤</span>
                Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
            </h2>
            
            <!-- Upload Mode Selection -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-4">
                    <label class="flex items-center">
                        <input type="radio" name="uploadMode" value="single" checked class="ml-2">
                        <span>ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø³ØªÙ†Ø¯ÙŠÙ†</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="uploadMode" value="dual" class="ml-2">
                        <span>ØµÙˆØ±ØªÙŠÙ† Ù…Ù†ÙØµÙ„ØªÙŠÙ†</span>
                    </label>
                </div>
            </div>

            <!-- Single Image Upload -->
            <div id="singleUpload" class="grid gap-6">
                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary transition-colors">
                    <input type="file" id="singleImageInput" accept="image/*" class="hidden">
                    <label for="singleImageInput" class="cursor-pointer">
                        <div class="text-4xl mb-4">ğŸ–¼ï¸</div>
                        <p class="text-lg font-medium">Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</p>
                        <p class="text-gray-500 dark:text-gray-400 mt-2">PNG, JPG, JPEG - Ø­ØªÙ‰ 10MB</p>
                    </label>
                </div>
            </div>

            <!-- Dual Images Upload -->
            <div id="dualUpload" class="hidden grid md:grid-cols-2 gap-6">
                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary transition-colors">
                    <input type="file" id="originalImageInput" accept="image/*" class="hidden">
                    <label for="originalImageInput" class="cursor-pointer">
                        <div class="text-4xl mb-4">ğŸ“„</div>
                        <p class="text-lg font-medium">Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ</p>
                        <p class="text-gray-500 dark:text-gray-400 mt-2">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</p>
                    </label>
                </div>
                
                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary transition-colors">
                    <input type="file" id="testImageInput" accept="image/*" class="hidden">
                    <label for="testImageInput" class="cursor-pointer">
                        <div class="text-4xl mb-4">ğŸ”</div>
                        <p class="text-lg font-medium">Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¯ ÙØ­ØµÙ‡</p>
                        <p class="text-gray-500 dark:text-gray-400 mt-2">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„ØªØ­Ù‚Ù‚</p>
                    </label>
                </div>
            </div>
        </div>

        <!-- Image Display and Selection Area -->
        <div id="imageArea" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-6 flex items-center">
                <span class="ml-2">ğŸ¯</span>
                ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
            </h3>
            
            <div class="grid gap-6" id="imageDisplay">
                <!-- Images will be displayed here -->
            </div>

            <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <p class="text-sm text-blue-700 dark:text-blue-300">
                    <strong>ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø© ÙÙŠ ÙƒÙ„Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©. ÙŠÙØ¶Ù„ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø§Ø·Ù‚ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØµÙˆØµ Ø£Ùˆ Ø±Ù…ÙˆØ² ÙˆØ§Ø¶Ø­Ø©.
                </p>
            </div>

            <div class="mt-6 flex justify-center">
                <button id="startAnalysis" class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    ğŸ”¬ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
                </button>
            </div>
        </div>

        <!-- Analysis Results -->
        <div id="analysisResults" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold mb-6 flex items-center">
                <span class="ml-2">ğŸ“Š</span>
                Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
            </h3>
            
            <div id="analysisContent">
                <!-- Results will be displayed here -->
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center">
            <div class="animate-spin text-4xl mb-4">ğŸ”„</div>
            <h3 class="text-xl font-bold mb-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h3>
            <p class="text-gray-600 dark:text-gray-400 loading-dots">ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¨ØµØ±ÙŠØ© ÙˆØ§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</p>
            <div class="mt-4 text-sm text-gray-500 dark:text-gray-400">
                <p>â€¢ ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙˆØ§Ù„ØªØ¨Ø§ÙŠÙ†</p>
                <p>â€¢ ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù…Ø³ Ø§Ù„ÙˆØ±Ù‚</p>
                <p>â€¢ ÙØ­Øµ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø­Ø¨Ø±</p>
                <p>â€¢ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 dark:bg-gray-900 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>ØªØ·ÙˆÙŠØ±: Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© | Ù…: Ø±Ø£ÙØª Ø¹Ù…Ø±</p>
            <p class="text-gray-400 mt-2">Ø±Ù‚ÙŠØ¨ Ø§Ù„Ù…Ø·ÙˆØ± - Ù…Ù†ØµØ© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ</p>
        </div>
    </footer>

    <script>
        let uploadMode = 'single';
        let images = {};
        let selections = {};

        // Handle upload mode change
        document.querySelectorAll('input[name="uploadMode"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                uploadMode = e.target.value;
                document.getElementById('singleUpload').classList.toggle('hidden', uploadMode !== 'single');
                document.getElementById('dualUpload').classList.toggle('hidden', uploadMode !== 'dual');
                resetInterface();
            });
        });

        // Handle file uploads
        document.getElementById('singleImageInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files[0], 'single');
        });

        document.getElementById('originalImageInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files[0], 'original');
        });

        document.getElementById('testImageInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files[0], 'test');
        });

        function handleFileUpload(file, type) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                images[type] = e.target.result;
                displayImages();
            };
            reader.readAsDataURL(file);
        }

        function displayImages() {
            const imageDisplay = document.getElementById('imageDisplay');
            const imageArea = document.getElementById('imageArea');
            
            imageDisplay.innerHTML = '';

            if (uploadMode === 'single' && images.single) {
                imageDisplay.innerHTML = `
                    <div class="canvas-container mx-auto">
                        <img src="${images.single}" class="max-w-full h-auto max-h-96 rounded-lg shadow" id="singleImg">
                        <div class="mt-4 text-center">
                            <p class="text-gray-600 dark:text-gray-400">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ) Ø«Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¯ ÙØ­ØµÙ‡)</p>
                        </div>
                    </div>
                `;
                imageArea.classList.remove('hidden');
            } else if (uploadMode === 'dual' && images.original && images.test) {
                imageDisplay.innerHTML = `
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="text-center">
                            <h4 class="font-medium mb-3">Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ</h4>
                            <div class="canvas-container">
                                <img src="${images.original}" class="w-full h-auto max-h-80 rounded-lg shadow" id="originalImg">
                            </div>
                        </div>
                        <div class="text-center">
                            <h4 class="font-medium mb-3">Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¯ ÙØ­ØµÙ‡</h4>
                            <div class="canvas-container">
                                <img src="${images.test}" class="w-full h-auto max-h-80 rounded-lg shadow" id="testImg">
                            </div>
                        </div>
                    </div>
                `;
                imageArea.classList.remove('hidden');
            }

            // Enable selection functionality
            setTimeout(enableImageSelection, 100);
        }

        function enableImageSelection() {
            // This would implement the selection functionality
            // For now, we'll enable the analysis button
            const startButton = document.getElementById('startAnalysis');
            startButton.disabled = false;
        }

        // Handle analysis start
        document.getElementById('startAnalysis').addEventListener('click', startAnalysis);

        async function startAnalysis() {
            const loadingState = document.getElementById('loadingState');
            const imageArea = document.getElementById('imageArea');
            const analysisResults = document.getElementById('analysisResults');

            // Show loading state
            imageArea.classList.add('hidden');
            loadingState.classList.remove('hidden');
            analysisResults.classList.add('hidden');

            // Register handler for analysis results
            window.Poe.registerHandler("document-analysis", (result, context) => {
                const msg = result.responses[0];
                
                if (msg.status === "error") {
                    showAnalysisError("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„: " + msg.statusText);
                } else if (msg.status === "complete") {
                    showAnalysisResults(msg.content);
                    loadingState.classList.add('hidden');
                    analysisResults.classList.remove('hidden');
                }
            });

            try {
                // Prepare analysis prompt
                const analysisPrompt = `@Claude-Sonnet-4 Ù‚Ù… Ø¨ØªØ­Ù„ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ± Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù„ÙØ­Øµ Ø§Ù„Ø£ØµØ§Ù„Ø© ÙˆØ§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªØ²ÙˆÙŠØ±. Ø±ÙƒØ² Ø¹Ù„Ù‰:

1. Ù…Ù„Ù…Ø³ Ø§Ù„ÙˆØ±Ù‚ ÙˆÙ†ÙˆØ¹ÙŠØªÙ‡
2. Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø­Ø¨Ø± ÙˆØ§Ù…ØªØµØ§ØµÙ‡
3. Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ¯Ù‚ØªÙ‡Ø§
4. Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¬Ù‡Ø±ÙŠØ© ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
5. Ø§Ù„ØªÙ†Ø§Ø³Ù‚ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©

ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª ÙÙŠ:
- Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙˆØ§Ù„Ø¸Ù„Ø§Ù„
- Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØµÙˆÙŠØ±
- Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØµÙˆØ±Ø©

Ù‚Ø¯Ù… ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙŠØªØ¶Ù…Ù†:
- ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ù… Ù„Ù„Ø£ØµØ§Ù„Ø© (Ø£ØµÙ„ÙŠ/Ù…Ø´ÙƒÙˆÙƒ ÙÙŠÙ‡/Ù…Ø²ÙŠÙ)
- ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ø®Ø§ØµÙŠØ©
- Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¶Ø¹Ù ÙÙŠ ÙƒÙ„ Ù…Ø³ØªÙ†Ø¯
- ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¥Ù† Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±

Ù‚Ø¯Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON Ù…Ù†Ø¸Ù… Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.`;

                // Create attachments array with the uploaded images
                const attachments = [];
                if (uploadMode === 'single' && images.single) {
                    // Convert base64 to file for single image
                    const file = await base64ToFile(images.single, 'combined_document.jpg');
                    attachments.push(file);
                } else if (uploadMode === 'dual') {
                    if (images.original) {
                        const originalFile = await base64ToFile(images.original, 'original_document.jpg');
                        attachments.push(originalFile);
                    }
                    if (images.test) {
                        const testFile = await base64ToFile(images.test, 'test_document.jpg');
                        attachments.push(testFile);
                    }
                }

                await window.Poe.sendUserMessage(analysisPrompt, {
                    handler: "document-analysis",
                    stream: false,
                    openChat: false,
                    attachments: attachments
                });

            } catch (error) {
                showAnalysisError("Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„: " + error.message);
                loadingState.classList.add('hidden');
                imageArea.classList.remove('hidden');
            }
        }

        async function base64ToFile(base64String, fileName) {
            const response = await fetch(base64String);
            const blob = await response.blob();
            return new File([blob], fileName, { type: blob.type });
        }

        function showAnalysisResults(content) {
            const analysisContent = document.getElementById('analysisContent');
            
            try {
                // Try to parse JSON if the response is in JSON format
                const results = JSON.parse(content);
                
                analysisContent.innerHTML = `
                    <div class="analysis-result space-y-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-6 rounded-lg">
                            <h4 class="text-lg font-bold mb-3 flex items-center">
                                <span class="ml-2">ğŸ¯</span>
                                Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…
                            </h4>
                            <div class="text-lg font-medium ${results.authenticity === 'Ø£ØµÙ„ÙŠ' ? 'text-green-600' : results.authenticity === 'Ù…Ø²ÙŠÙ' ? 'text-red-600' : 'text-yellow-600'}">
                                ${results.authenticity || 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„'}
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                <h5 class="font-bold mb-3">ğŸ“ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ±Ù‚</h5>
                                <p class="text-sm">${results.paper_analysis || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                <h5 class="font-bold mb-3">ğŸ–‹ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¨Ø±</h5>
                                <p class="text-sm">${results.ink_analysis || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                <h5 class="font-bold mb-3">ğŸ–¨ï¸ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h5>
                                <p class="text-sm">${results.print_quality || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                <h5 class="font-bold mb-3">ğŸ”¬ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ù‡Ø±ÙŠØ©</h5>
                                <p class="text-sm">${results.microscopic_details || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                            <h5 class="font-bold mb-3 flex items-center">
                                <span class="ml-2">ğŸ’¡</span>
                                Ø§Ù„ØªÙˆØµÙŠØ§Øª
                            </h5>
                            <p class="text-sm">${results.recommendations || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©'}</p>
                        </div>
                    </div>
                `;
            } catch (e) {
                // If not JSON, display as formatted text
                analysisContent.innerHTML = `
                    <div class="analysis-result">
                        <div class="prose dark:prose-invert max-w-none">
                            ${content.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                `;
            }
        }

        function showAnalysisError(errorMessage) {
            const analysisContent = document.getElementById('analysisContent');
            analysisContent.innerHTML = `
                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                    <h4 class="text-red-800 dark:text-red-300 font-medium mb-2">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„</h4>
                    <p class="text-red-700 dark:text-red-400">${errorMessage}</p>
                    <button onclick="location.reload()" class="mt-3 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">
                        Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                    </button>
                </div>
            `;
        }

        function resetInterface() {
            images = {};
            selections = {};
            document.getElementById('imageArea').classList.add('hidden');
            document.getElementById('analysisResults').classList.add('hidden');
            document.getElementById('loadingState').classList.add('hidden');
        }
    </script>
</body>
</html>
