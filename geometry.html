<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تحليل هندسي | رقيب</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <style>
    body {
      background: #1a1a1a;
      font-family: 'Tajawal', sans-serif;
      color: #ffa500;
      text-align: center;
      padding: 2rem;
    }
    .image-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    .image-box {
      background: #2c2c2c;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 10px #000;
      width: 45%;
      margin-bottom: 1rem;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 1rem;
    }
    .score-box {
      font-size: 1.3rem;
      margin-top: 2rem;
      background: #222;
      padding: 1rem;
      border-radius: 10px;
      color: #fff;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #777;
    }
  </style>
</head>
<body>

  <h1>📐 تحليل الشكل الهندسي</h1>
  <p>معاينة الأبعاد ونسبة تطابق الصور باستخدام خوارزمية هندسية</p>

  <div class="image-container">
    <div class="image-box">
      <h3>📷 الصورة الأصل</h3>
      <p id="info1"></p>
      <img id="img1">
    </div>
    <div class="image-box">
      <h3>📷 صورة التحقق</h3>
      <p id="info2"></p>
      <img id="img2">
    </div>
  </div>

  <div class="score-box" id="result">🔍 جاري الحساب...</div>

  <footer>
    رقيب — تنفيذ هندسي ذكي | م: رأفت عمر
  </footer>

  <script>
    async function runAnalysis() {
      const params = new URLSearchParams(window.location.search);
      const img1Data = decodeURIComponent(params.get("img1"));
      const img2Data = decodeURIComponent(params.get("img2"));

      const img1El = document.getElementById("img1");
      const img2El = document.getElementById("img2");
      img1El.src = img1Data;
      img2El.src = img2Data;

      await new Promise(r => img1El.onload = r);
      await new Promise(r => img2El.onload = r);

      const w1 = img1El.naturalWidth;
      const h1 = img1El.naturalHeight;
      const w2 = img2El.naturalWidth;
      const h2 = img2El.naturalHeight;

      document.getElementById("info1").textContent = `الأبعاد: ${w1} × ${h1}`;
      document.getElementById("info2").textContent = `الأبعاد: ${w2} × ${h2}`;

      const pyodide = await loadPyodide();
      const code = `
def geometry_score(w1, h1, w2, h2):
    r1 = w1 / h1
    r2 = w2 / h2
    diff = abs(r1 - r2)
    score = 100 - min(diff * 100, 100)
    return round(score, 2)

geometry_score(${w1}, ${h1}, ${w2}, ${h2})
      `;
      const result = await pyodide.runPythonAsync(code);
      document.getElementById("result").innerHTML = `✅ نسبة التشابه الهندسي: <strong>${result}%</strong>`;
    }

    runAnalysis();
  </script>

</body>
</html>
