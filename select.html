<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ­Ù„ÙŠÙ„ Ù†Ø³ÙŠØ¬ Ù…Ù†Ø·Ù‚ØªÙŠÙ† | RKEEB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background: #0b0b0b;
      color: #ff8800;
      font-family: 'Cairo', sans-serif;
      text-align: center;
      padding: 2rem;
    }
    canvas {
      border: 2px solid #ff8800;
      margin: 1rem auto;
      display: block;
      max-width: 100%;
    }
    input, button {
      padding: 0.8rem;
      margin-top: 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    input[type="file"] {
      background: #28a745;
      color: #fff;
    }
    button {
      background: #ff8800;
      color: #fff;
    }
    #result {
      margin-top: 1rem;
      font-size: 1.2rem;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h2>ğŸ“¤ ØªØ­Ù„ÙŠÙ„ Ù†Ø³ÙŠØ¬ Ù…Ù†Ø·Ù‚ØªÙŠÙ† Ø¯Ø§Ø®Ù„ ØµÙˆØ±Ø©</h2>
  <input type="file" accept="image/*" id="imageInput" />
  <canvas id="canvas" width="600" height="400"></canvas>
  <button onclick="compareAuto()">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø°ÙƒÙŠ</button>
  <div id="result">ğŸ” Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  let img = new Image();

  document.getElementById("imageInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      img.src = reader.result;
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        // Ø±Ø³Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
        ctx.strokeStyle = "#00ff00";
        ctx.strokeRect(80, 100, 120, 120);
        ctx.strokeStyle = "#ff0000";
        ctx.strokeRect(400, 100, 120, 120);
      };
    };
    reader.readAsDataURL(file);
  });

  function compareAuto() {
    const resultDiv = document.getElementById("result");
    const regions = [
      { x: 80, y: 100, w: 120, h: 120 },
      { x: 400, y: 100, w: 120, h: 120 }
    ];

    const analysis = regions.map(r => {
      const grid = 5;
      const stepX = r.w / grid;
      const stepY = r.h / grid;
      const values = [];

      for (let gy = 0; gy < grid; gy++) {
        for (let gx = 0; gx < grid; gx++) {
          const data = ctx.getImageData(r.x + gx * stepX, r.y + gy * stepY, stepX, stepY);
          values.push(sobel(data));
        }
      }

      const avg = mean(values);
      const dev = deviation(values, avg);
      return { avg, dev };
    });

    const [a, b] = analysis;
    const totalDiff = (Math.abs(a.avg - b.avg) + Math.abs(a.dev - b.dev)) / 2;
    const similarity = 100 - Math.min(totalDiff, 100);

    let verdict = "";
    if (similarity > 90) verdict = "âœ… Ø§Ù„Ù…Ù†Ø·Ù‚ØªØ§Ù† Ù…ØªØ·Ø§Ø¨Ù‚ØªØ§Ù† ÙØ¹Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù†Ø³ÙŠØ¬ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ";
    else if (similarity > 70) verdict = "ğŸŸ¡ Ù‡Ù†Ø§Ùƒ ØªÙ‚Ø§Ø±Ø¨ Ø¬Ø²Ø¦ÙŠ ÙÙŠ Ø§Ù„ØªØ´ÙˆÙŠØ´";
    else verdict = "ğŸ”´ Ø§Ù„Ù…Ù†Ø·Ù‚ØªØ§Ù† Ù…Ø®ØªÙ„ÙØªØ§Ù† Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©";

    resultDiv.innerHTML = `
      <strong>ğŸŸ¦ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙŠØ³Ø±Ù‰:</strong><br>
      - Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø¯Ø©: ${a.avg.toFixed(2)}<br>
      - Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„ØªÙˆØ²ÙŠØ¹: ${a.dev.toFixed(2)}<br><br>

      <strong>ğŸŸ¥ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰:</strong><br>
      - Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø¯Ø©: ${b.avg.toFixed(2)}<br>
      - Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„ØªÙˆØ²ÙŠØ¹: ${b.dev.toFixed(2)}<br><br>

      <strong>ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ:</strong> ${similarity.toFixed(1)}%<br>
      <strong>ğŸ” Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${verdict}
    `;
  }

  function sobel(imgData) {
    const d = imgData.data;
    let sum = 0;
    for (let i = 0; i < d.length; i += 4) {
      const gray = (d[i] + d[i+1] + d[i+2]) / 3;
      sum += gray;
    }
    return sum / (imgData.width * imgData.height);
  }

  function mean(arr) {
    return arr.reduce((a,b) => a + b, 0) / arr.length;
  }

  function deviation(arr, avg) {
    return Math.sqrt(arr.reduce((a,b) => a + Math.pow(b - avg, 2), 0) / arr.length);
  }
</script>
</body>
</html>
