<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´ÙƒÙ„ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± ØªØ´Ø§Ø¨Ù‡Ù‹Ø§</title>
  <script src="https://docs.opencv.org/4.5.2/opencv.js" type="text/javascript"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    canvas { border: 1px solid #aaa; margin-top: 10px; }
    #analyzeBtn { margin-top: 15px; padding: 10px 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>ğŸ“ ØªØ­Ù„ÙŠÙ„ ØªØ´Ø§Ø¨Ù‡ Ø´ÙƒÙ„ÙŠÙ† Ù‡Ù†Ø¯Ø³ÙŠÙŠÙ†</h2>

  <input type="file" id="imgInput" accept="image/*"><br>
  <canvas id="canvasOutput"></canvas><br>
  <button id="analyzeBtn">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>

  <script type="text/javascript">
    let ready = false;
    let loadedImage = null;

    cv['onRuntimeInitialized'] = () => {
      ready = true;
      console.log('ğŸ“¦ OpenCV ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­');
    };

    document.getElementById('imgInput').addEventListener('change', function (e) {
      let img = new Image();
      img.src = URL.createObjectURL(e.target.files[0]);
      img.onload = function () {
        let canvas = document.getElementById('canvasOutput');
        canvas.width = img.width;
        canvas.height = img.height;
        let ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        loadedImage = img;
      };
    });

    document.getElementById('analyzeBtn').addEventListener('click', function () {
      if (!ready) {
        alert("â³ OpenCV.js Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯.");
        return;
      }
      if (!loadedImage) {
        alert("ğŸ“ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹.");
        return;
      }

      let canvas = document.getElementById('canvasOutput');
      let src = cv.imread(canvas);
      let gray = new cv.Mat();
      cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
      let edges = new cv.Mat();
      cv.Canny(gray, edges, 50, 150);

      let contours = new cv.MatVector();
      let hierarchy = new cv.Mat();
      cv.findContours(edges, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

      let bestScore = Infinity;
      let bestPair = [null, null];
      for (let i = 0; i < contours.size(); i++) {
        for (let j = i + 1; j < contours.size(); j++) {
          let score = cv.matchShapes(contours.get(i), contours.get(j), cv.CONTOURS_MATCH_I1, 0);
          if (score < bestScore) {
            bestScore = score;
            bestPair = [i, j];
          }
        }
      }

      let color = new cv.Scalar(255, 0, 0, 255);
      cv.drawContours(src, contours, bestPair[0], color, 3);
      cv.drawContours(src, contours, bestPair[1], color, 3);
      cv.imshow('canvasOutput', src);

      src.delete(); gray.delete(); edges.delete(); contours.delete(); hierarchy.delete();
    });
  </script>
</body>
</html>
