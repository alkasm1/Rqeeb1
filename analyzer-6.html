<!-- ğŸ–¼ï¸ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© -->
<input type="file" id="imageUpload" accept="image/*" onchange="loadImage(event)">
<br>
<canvas id="imageCanvas"></canvas>
<br><br>

<!-- ğŸ”˜ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
<button onclick="previewShapes()">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©</button>
<button onclick="analyzeImage()">ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>

<script type="text/javascript">
function loadImage(event) {
  let img = new Image();
  img.onload = function () {
    let canvas = document.getElementById('imageCanvas');
    let ctx = canvas.getContext('2d');
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);
  };
  img.src = URL.createObjectURL(event.target.files[0]);
}

function previewShapes() {
  let src = cv.imread('imageCanvas');
  let gray = new cv.Mat();
  cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);

  let contours = new cv.MatVector();
  let hierarchy = new cv.Mat();
  cv.findContours(gray, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

  let imageArea = src.cols * src.rows;
  let preview = src.clone();

  for (let i = 0; i < contours.size(); i++) {
    let cnt = contours.get(i);
    let area = cv.contourArea(cnt);

    if (area >= imageArea * 0.4) {
      let color = new cv.Scalar(255, 0, 0, 255); // Ù„ÙˆÙ† Ø£Ø­Ù…Ø±
      cv.drawContours(preview, contours, i, color, 2, cv.LINE_8, hierarchy, 0);
    }
  }

  cv.imshow('imageCanvas', preview);
  gray.delete(); hierarchy.delete(); contours.delete(); preview.delete();
}

function analyzeImage() {
  let src = cv.imread('imageCanvas');
  let gray = new cv.Mat();
  cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);

  let contours = new cv.MatVector();
  let hierarchy = new cv.Mat();
  cv.findContours(gray, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

  let imageArea = src.cols * src.rows;
  let validShapes = [];

  for (let i = 0; i < contours.size(); i++) {
    let cnt = contours.get(i);
    let area = cv.contourArea(cnt);

    if (area >= imageArea * 0.4) {
      validShapes.push({ contour: cnt, area });
    }
  }

  if (validShapes.length < 2) {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´ÙƒÙ„ÙŠÙ† ÙŠØªØ¬Ø§ÙˆØ²Ø§Ù† 40Ùª Ù…Ù† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©!");
    return;
  }

  compareShapes(validShapes[0].contour, validShapes[1].contour);

  gray.delete(); hierarchy.delete(); contours.delete();
}
</script>
