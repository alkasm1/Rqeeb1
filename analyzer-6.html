<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Shape Matcher</title>
  <script src="https://docs.opencv.org/4.5.2/opencv.js" type="text/javascript"></script>
  <style>
    canvas { border: 1px solid #ccc; margin-top: 10px; }
  </style>
</head>
<body>
  <h3>ğŸ” Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø´ÙƒÙ„ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± ØªØ´Ø§Ø¨Ù‡Ù‹Ø§</h3>
  <input type="file" id="imgInput" accept="image/*">
  <canvas id="canvasOutput"></canvas>

  <script type="text/javascript">
    let ready = false;

    // ØªØ£ÙƒÙŠØ¯ ØªØ­Ù…ÙŠÙ„ OpenCV Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    cv['onRuntimeInitialized'] = () => {
      ready = true;
      console.log('OpenCV Ø¬Ø§Ù‡Ø² âœ…');
    };

    document.getElementById('imgInput').addEventListener('change', function (e) {
      if (!ready) {
        alert("OpenCV.js Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø§Ù†ÙŠØ©.");
        return;
      }

      let img = new Image();
      img.src = URL.createObjectURL(e.target.files[0]);
      img.onload = function () {
        let canvas = document.getElementById('canvasOutput');
        canvas.width = img.width;
        canvas.height = img.height;
        let ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);

        let src = cv.imread(canvas);
        let gray = new cv.Mat();
        cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
        let edges = new cv.Mat();
        cv.Canny(gray, edges, 50, 150);

        let contours = new cv.MatVector();
        let hierarchy = new cv.Mat();
        cv.findContours(edges, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

        let bestScore = Infinity;
        let bestPair = [null, null];

        for (let i = 0; i < contours.size(); i++) {
          for (let j = i + 1; j < contours.size(); j++) {
            let score = cv.matchShapes(contours.get(i), contours.get(j), cv.CONTOURS_MATCH_I1, 0);
            if (score < bestScore) {
              bestScore = score;
              bestPair = [i, j];
            }
          }
        }

        let color = new cv.Scalar(255, 0, 0, 255);
        cv.drawContours(src, contours, bestPair[0], color, 3);
        cv.drawContours(src, contours, bestPair[1], color, 3);
        cv.imshow('canvasOutput', src);

        src.delete(); gray.delete(); edges.delete(); contours.delete(); hierarchy.delete();
      };
    });
  </script>
</body>
</html>
